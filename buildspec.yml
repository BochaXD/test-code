version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - npm ci
      - echo "üîç Verificando librer√≠as deprecadas..."
      - npm ls deprecated > deprecated.txt || true
      - cat deprecated.txt
      - if grep -q 'deprecated' deprecated.txt; then echo "‚ùå Se encontraron librer√≠as deprecadas. Revisa 'deprecated.txt' para m√°s detalles."; exit 1; fi
      - echo "üîç Verificando librer√≠as desactualizadas..."
      - npm outdated > outdated.txt || true
      - cat outdated.txt
      - if grep -q 'Package' outdated.txt; then echo "‚ö†Ô∏è Se encontraron librer√≠as desactualizadas. Revisa 'outdated.txt' para m√°s detalles."; exit 1; fi

  build:
    commands:
      - npm test
      - echo "üìÅ Contenido del directorio 'reports/':"
      - ls -la reports || echo "‚ö†Ô∏è El directorio 'reports' no existe."
      - echo "üìÑ Primeras l√≠neas de 'junit.xml':"
      - cat reports/junit.xml | head || echo "‚ö†Ô∏è El archivo 'junit.xml' no existe."

reports:
  pruebas:
    base-directory: .
    files:
      - 'reports/junit.xml'
    file-format: 'JUNITXML'

  cobertura_codigo:
    base-directory: 'coverage'
    files:
      - 'lcov-report/**/*'
      - 'clover.xml'
    file-format: 'CLOVERXML'
    discard-paths: no

artifacts:
  files:
    - reports/junit.xml
    - coverage/lcov.info
    - coverage/lcov-report/index.html
    - coverage/coverage-final.json
    - dist/**
