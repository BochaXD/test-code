version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - echo "ğŸ”„ Instalando dependencias..."
      - npm ci --silent

      - echo "ğŸ” Verificando librerÃ­as deprecadas..."
      - |
        npm ls deprecated --json > deprecated.json || true
        if grep -q '"deprecated":' deprecated.json; then
          echo "âŒ Se encontraron librerÃ­as deprecadas. Revisa 'deprecated.json' para mÃ¡s detalles."
          exit 1
        fi

      - echo "ğŸ” Verificando librerÃ­as desactualizadas..."
- npm outdated --json > outdated.json || true
- if [ -s outdated.json ]; then
    echo "âš ï¸ Se encontraron librerÃ­as desactualizadas. Revisa 'outdated.json' para mÃ¡s detalles."
  fi


  build:
    commands:
      - echo "ğŸ§ª Ejecutando pruebas..."
      - npm test
      - echo "ğŸ“ Verificando directorio 'reports/'..."
      - |
        if [ -d reports ]; then
          echo "âœ… El directorio 'reports/' existe."
        else
          echo "âš ï¸ El directorio 'reports/' no existe."
        fi
      - echo "ğŸ“„ Verificando archivo 'junit.xml'..."
      - |
        if [ -f reports/junit.xml ]; then
          echo "âœ… El archivo 'junit.xml' existe."
        else
          echo "âš ï¸ El archivo 'junit.xml' no existe."
        fi

reports:
  pruebas:
    base-directory: .
    files:
      - 'reports/junit.xml'
    file-format: 'JUNITXML'

  cobertura_codigo:
    base-directory: 'coverage'
    files:
      - 'lcov-report/**/*'
      - 'clover.xml'
    file-format: 'CLOVERXML'
    discard-paths: no

artifacts:
  files:
    - reports/junit.xml
    - coverage/lcov.info
    - coverage/lcov-report/index.html
    - coverage/coverage-final.json
    - dist/**
