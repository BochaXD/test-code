version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - npm install

  build:
    commands:
      - npm test
      - echo "ðŸ“„ Verificando archivos generados..."
      - ls -la reports coverage || true
      - echo "ðŸ§ª Reporte de pruebas (JUnit):"
      - cat reports/junit.xml || true
      - echo "ðŸ“Š Reporte de cobertura (LCOV):"
      - head -20 coverage/lcov.info || true
      - echo "ðŸ”§ Corrigiendo TN vacÃ­o..."
      - grep -q '^TN:' coverage/lcov.info || sed -i '1iTN:DefaultTestName' coverage/lcov.info
      - sed -i 's/^TN:$/TN:DefaultTestName/' coverage/lcov.info

reports:
  pruebas:
    files:
      - reports/junit.xml
    file-format: JUNITXML

  cobertura:
    base-directory: coverage
    files:
      - lcov.info
    file-format: LCOV

artifacts:
  files:
    - reports/junit.xml
    - coverage/lcov.info
    - coverage/lcov-report/index.html
    - coverage/coverage-final.json
